webpackJsonp([15],{KQCM:function(t,e){},dRe5:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r("BO1k"),a=r.n(i),n=r("mvHQ"),s=r.n(n),o=r("Dd8w"),l=r.n(o),u=r("gNfH"),d=r("uL18"),c=r("2Uyi"),g=r("NYxO"),p={name:"registration",computed:{},components:{TopToolBar:u.a,Loading:d.a},data:function(){return{loading:!1,subGroup:[],originList:[],managementTypeList:[],show:!1,title:"",checkresult:[{label:"未提交",value:"1"},{label:"待审核",value:"2"},{label:"审核中",value:"3"},{label:"通过",value:"4"},{label:"未通过",value:"5"}],registerCard:{registerCardNo:"",registerCardName:"",validityStart:"",validityEnd:"",origin:"",managementType:"",name:"",nameEn:"",standard:"",model:"",manufactureName:"",manufactureNameEn:"",proxyName:"",expirationStart:"",expirationEnd:"",approvalDate:"",structure:"",scope:"",medicalFile:"",auditStatus:"",aup2ProjectTypeId:"",orgInfoId:"",orgInfoName:"",medicalFileList:[],registFileList:[],fdaFileList:[],otherFileList:[],attributeConfigJson:[]},categories:[],formRule:{registerCardNo:[{required:!0,message:"注册证编号不能为空",trigger:"blur"}],name:[{required:!0,message:"产品名称(中文)不能为空",trigger:"blur"}],manufactureName:[{required:!0,message:"生产企业(中文)不能为空",trigger:"blur"}],registerCardName:[{required:!0,message:"注册证名称不能为空",trigger:"blur"}],origin:[{required:!0,message:"产地不能为空",trigger:"change"}],managementType:[{required:!0,message:"管理类别不能为空",trigger:"change"}],aup2ProjectTypeId:[{required:!0,message:"分类目录不能为空",trigger:"change"}],validityStart:[{required:!0,message:"注册证有效期起不能为空",trigger:"change"}],validityEnd:[{required:!0,message:"注册证有效期止不能为空",trigger:"change"}]},preview:!1,previewUrl:"",columns:[{title:"组件名称",key:"subGroupName",align:"center"},{title:"产品转换比",key:"conversionRatio",align:"center"},{title:"最小使用单位",key:"minUnit",align:"center"},{title:"包装单位",key:"packUnit",align:"center"},{title:"产品材质",key:"productMaterial",align:"center"},{title:"产品包装材质",key:"productPackMaterial",align:"center"},{title:"使用范围",key:"scope",align:"center"},{title:"说明书",key:"auditStatus",align:"center"}],filter:l()({page:1,size:10},this.$route.params),total:0}},created:function(){this.fetchData()},methods:l()({},Object(g.b)(["productAddr","manageType"]),{backs:function(){sessionStorage.setItem("produceState","2"),"1"==sessionStorage.getItem("mlistedit")?this.$router.push({path:"/ma1/registration/"+this.$route.params.projectApplyId}):this.$router.back(-1)},handleReview:function(t){var e=this;if(t.response&&(t=t.response.content),-1==t.name.indexOf("zip")){this.spinShow=!0,this.preview=!0,this.imageLoadingText="";var r=document.querySelector("#previewUrl");r.src=t.url,r.onload=function(r){e.previewUrl=t.url,e.spinShow=!1},r.onerror=function(t){e.imageLoadingText="图片加载失败"}}else window.open(t.url)},handleComplete:function(t,e,r,i){if(e&&e.success){var a=[],n=this.registerCard.attributeJson[t],s=this.registerCard.attributeJson[t+"_fileInfos"];a.push(e.content.id),[].push(e.content),null==s&&(this.registerCard.attributeJson[t+"_fileInfos"]=[]),""!=n?(n=this.registerCard.attributeJson[t].split(","),this.registerCard.attributeJson[t]=n.concat(a).join(",")):this.registerCard.attributeJson[t]=a.join(","),this.registerCard.attributeJson[t+"_fileInfos"].push(e.content)}},handleRemove:function(t,e,r){null!=r&&(this.registerCard.attributeJson[t+"_fileInfos"]=r),this.registerCard.attributeJson[t]=r.map(function(t){return t.id}).join(",")},handleSelect:function(t,e){return!(null!=this.registerCard.attributeJson[t]&&this.registerCard.attributeJson[t].length>6)||("productApplySummaryList"===t?this.$Message.warning("最多只能上传七张照片，如果超过7张，请从第七张开始打包成ZIP格式上传!"):this.$Message.warning("最多只能上传七张照片!"),!1)},handleFormatError:function(t){this.$Message.warning("请上传图片或zip压缩包")},onSubmit:function(t){var e=this;t.preventDefault();var r={manufacture_overview:this.registerCard.attributeJson.manufacture_overview,detaining_needle:this.registerCard.attributeJson.detaining_needle,suture_line:this.registerCard.attributeJson.suture_line,narcotization_unit:this.registerCard.attributeJson.narcotization_unit,heparin_tube:this.registerCard.attributeJson.heparin_tube,pca:this.registerCard.attributeJson.pca,infusing_outfit:this.registerCard.attributeJson.infusing_outfit},i={attributeJson:s()(r)};this.$store.dispatch("apply/saveOrUpdateAddDetail",i).then(function(t){(e.loading=!1,t&&t.success)&&(e.$Message.success({content:"成功"}),"add"==e.$route.params.projectApplyId||("1"==sessionStorage.getItem("mlistedit")?e.$router.push({path:"/BJCLZB/BJCLZB001/detail/"+e.$route.params.projectApplyId}):e.$router.back(-1)))})},fetchData:function(){var t=this;this.loading=!0,console.log(this.$route.params);this.$route.params;var e={projectApplyId:sessionStorage.getItem("projectApplyId")};"add"==this.$route.params.projectApplyId?(this.show=!1,this.title="材料新增"):(this.show=!0,this.title="材料编辑"),this.$store.dispatch("apply/addDetail",e).then(function(e){if(t.loading=!1,e.success&&e.content&&null!=e.content.data){var r=e.content.data.attributeConfigJson;if(r&&"add"==t.$route.params.projectApplyId){var i={},n=!0,s=!1,o=void 0;try{for(var l,u=a()(r);!(n=(l=u.next()).done);n=!0){var d=l.value,g=!0,p=!1,h=void 0;try{for(var f,m=a()(d.attributes);!(g=(f=m.next()).done);g=!0){var v=f.value;i[v.code+"_fileInfos"]=[],i[v.code]=""}}catch(t){p=!0,h=t}finally{try{!g&&m.return&&m.return()}finally{if(p)throw h}}}}catch(t){s=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(s)throw o}}t.registerCard.attributeJson=i,t.registerCard.attributeConfigJson=e.content.data.attributeConfigJson}else{t.registerCard=e.content.data;var b=e.content.data.attributeJson;for(var C in b)-1!=C.indexOf("fileInfos")&&null!=b[C]&&0!=b[C].length&&(b[C]=Object(c.remove)(b[C],null))}}})}})},h={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("Loading",{attrs:{loading:t.loading}}),t._v(" "),r("top-tool-bar",{attrs:{title:t.title}},[r("span",{attrs:{slot:"btn"},slot:"btn"},[r("Button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("保存")]),t._v(" "),r("Button",{attrs:{type:"primary"},on:{click:function(e){t.backs()}}},[t._v("取消")])],1),t._v(" "),r("span",{attrs:{slot:"content"},slot:"content"},[r("strong",{staticClass:"help"},[t._v("说明")]),t._v(" "),r("p",[t._v("\n        企业向某个项目报名前需提交企业资料申报，\n        "),r("br"),t._v("\n        需准备：基本资料、资质与授权文件。\n        "),r("br"),t._v("\n        支持：保存、编辑、提交审核，\n        "),r("br"),t._v("\n        提交后需管理端确认审核通过。\n      ")])])]),t._v(" "),r("div",{staticClass:"page-container"},[r("h5",{staticClass:"title"},[t.registerCard.attributeConfigJson.length?r("span",[t._v("\n        "+t._s(t.registerCard.attributeConfigJson[0].name)+"\n      ")]):t._e()]),t._v(" "),t.registerCard.attributeConfigJson.length?r("div",t._l(t.registerCard.attributeConfigJson,function(e){return r("div",[r("table",{staticClass:"info-table"},t._l(e.attributes,function(e){return r("tr",[r("th",{staticClass:"label"},[e.allowBlank?t._e():r("span",{staticClass:"required"},[t._v("*")]),t._v(" "+t._s(e.name))]),t._v(" "),r("td",{attrs:{colspan:"3"}},[r("Upload",{attrs:{action:"/portal/pub/comm/uploadimage","on-success":t.handleComplete.bind(this,e.code),"default-file-list":null!=t.registerCard.attributeJson[e.code+"_fileInfos"]?t.registerCard.attributeJson[e.code+"_fileInfos"]:[],"before-upload":t.handleSelect.bind(this,e.code+"_fileInfos"),"on-remove":t.handleRemove.bind(this,e.code),"on-preview":t.handleReview,"on-format-error":t.handleFormatError,format:["jpg","jpeg","png","gif","zip"]}},[r("Button",{attrs:{type:"ghost"}},[t._v("上传文件")])],1)],1)])}))])})):t._e(),t._v(" "),r("Modal",{attrs:{width:"800",title:"查看大图"},on:{"on-ok":function(t){},"on-cancel":function(e){t.preview=!1}},model:{value:t.preview,callback:function(e){t.preview=e},expression:"preview"}},[r("img",{staticStyle:{width:"100%"},attrs:{src:t.previewUrl,alt:"",id:"previewUrl"}})])],1)],1)},staticRenderFns:[]};var f=r("VU/8")(p,h,!1,function(t){r("KQCM")},"data-v-6064dc29",null);e.default=f.exports}});