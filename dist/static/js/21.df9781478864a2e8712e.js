webpackJsonp([21],{"2CeI":function(t,e){},SqOQ:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r("//Fk"),i=r.n(a),s=r("BO1k"),n=r.n(s),o=r("d7EF"),l=r.n(o),d=r("W3Iv"),u=r.n(d),c=r("mvHQ"),g=r.n(c),p=r("Dd8w"),v=r.n(p),m=r("gNfH"),C=r("uL18"),f=r("2Uyi"),h=r("NYxO"),_={name:"registration",computed:{},components:{TopToolBar:m.a,Loading:C.a},data:function(){return{loading:!1,subGroup:[],originList:[],managementTypeList:[],show:!1,title:"",checkresult:[{label:"未提交",value:"1"},{label:"待审核",value:"2"},{label:"审核中",value:"3"},{label:"通过",value:"4"},{label:"未通过",value:"5"}],registerCard:{registerCardNo:"",registerCardName:"",validityStart:"",validityEnd:"",origin:"",managementType:"",name:"",nameEn:"",standard:"",model:"",manufactureName:"",manufactureNameEn:"",proxyName:"",expirationStart:"",expirationEnd:"",approvalDate:"",structure:"",scope:"",medicalFile:"",auditStatus:"",aup2ProjectTypeId:"",orgInfoId:"",orgInfoName:"",medicalFileList:[],registFileList:[],fdaFileList:[],otherFileList:[],attributeConfigJson:[]},categories:[],formRule:{registerCardNo:[{required:!0,message:"注册证编号不能为空",trigger:"blur"}],name:[{required:!0,message:"产品名称(中文)不能为空",trigger:"blur"}],manufactureName:[{required:!0,message:"生产企业(中文)不能为空",trigger:"blur"}],registerCardName:[{required:!0,message:"注册证名称不能为空",trigger:"blur"}],origin:[{required:!0,message:"产地不能为空",trigger:"change"}],managementType:[{required:!0,message:"管理类别不能为空",trigger:"change"}],aup2ProjectTypeId:[{required:!0,message:"分类目录不能为空",trigger:"change"}],validityStart:[{required:!0,message:"注册证有效期起不能为空",trigger:"change"}],validityEnd:[{required:!0,message:"注册证有效期止不能为空",trigger:"change"}]},preview:!1,previewUrl:"",columns:[{title:"组件名称",key:"subGroupName",align:"center"},{title:"产品转换比",key:"conversionRatio",align:"center"},{title:"最小使用单位",key:"minUnit",align:"center"},{title:"包装单位",key:"packUnit",align:"center"},{title:"产品材质",key:"productMaterial",align:"center"},{title:"产品包装材质",key:"productPackMaterial",align:"center"},{title:"使用范围",key:"scope",align:"center"},{title:"说明书",key:"auditStatus",align:"center"}],filter:v()({page:1,size:10},this.$route.params),total:0}},created:function(){this.fetchData(),this.getProductManaList(),this.getProductAddr(),this.fetchCategory()},methods:v()({},Object(h.b)(["productAddr","manageType"]),{backs:function(){sessionStorage.setItem("produceState","2"),"1"==sessionStorage.getItem("mlistedit")?this.$router.push({path:"/ma1/registration/"+this.$route.params.registerId}):this.$router.back(-1)},getRegisters:function(t){this.registerCard.validityStart=t},getRegistere:function(t){this.registerCard.validityEnd=t},handleReview:function(t){var e=this;if(t.response&&(t=t.response.content),-1==t.name.indexOf("zip")){this.spinShow=!0,this.preview=!0,this.imageLoadingText="";var r=document.querySelector("#previewUrl");r.src=t.url,r.onload=function(r){e.previewUrl=t.url,e.spinShow=!1},r.onerror=function(t){e.imageLoadingText="图片加载失败"}}else window.open(t.url)},handleComplete:function(t,e,r,a){if(e&&e.success){var i=[],s=this.registerCard.attributeJson[t],n=this.registerCard.attributeJson[t+"_fileInfos"];i.push(e.content.id),[].push(e.content),null==n&&(this.registerCard.attributeJson[t+"_fileInfos"]=[]),""!=s?(s=this.registerCard.attributeJson[t].split(","),this.registerCard.attributeJson[t]=s.concat(i).join(",")):this.registerCard.attributeJson[t]=i.join(","),n.push(e.content),console.log("添加添加"+this.registerCard.attributeJson[t])}},handleRemove:function(t,e,r){null!=r&&(this.registerCard.attributeJson[t+"_fileInfos"]=r),this.registerCard.attributeJson[t]=r.map(function(t){return t.id}).join(","),console.log("删除删除"+this.registerCard.attributeJson[t])},handleSelect:function(t,e){return!(null!=this.registerCard.attributeJson[t]&&this.registerCard.attributeJson[t].length>6)||("productApplySummaryList"===t?this.$Message.warning("最多只能上传七张照片，如果超过7张，请从第七张开始打包成ZIP格式上传!"):this.$Message.warning("最多只能上传七张照片!"),!1)},handleFormatError:function(t){this.$Message.warning("请上传图片或zip压缩包")},onSubmit:function(t){var e=this;t.preventDefault(),this.$refs.registerCard.validate(function(t,r){if(t){var a={medical_file:e.registerCard.attributeJson.medical_file,product_file:e.registerCard.attributeJson.product_file,fda_file:e.registerCard.attributeJson.fda_file,quality_file:e.registerCard.attributeJson.quality_file,check_file:e.registerCard.attributeJson.check_file,patent_file:e.registerCard.attributeJson.patent_file,invoices_file:e.registerCard.attributeJson.invoices_file,other_file:e.registerCard.attributeJson.other_file},i={registerCardNo:e.registerCard.registerCardNo,registerCardName:e.registerCard.registerCardName,name:e.registerCard.name,nameEn:e.registerCard.nameEn,manufactureName:e.registerCard.manufactureName,manufactureNameEn:e.registerCard.manufactureNameEn,proxyName:e.registerCard.proxyName,origin:e.registerCard.origin,managementType:e.registerCard.managementType,standard:e.registerCard.standard,model:e.registerCard.model,aup2ProjectTypeId:e.registerCard.aup2ProjectTypeId,validityStart:e.registerCard.validityStart,validityEnd:e.registerCard.validityEnd,structure:e.registerCard.structure,scope:e.registerCard.scope,attributeJson:g()(a)};"add"!=e.$route.params.registerId&&(i.id=e.$route.params.registerId),e.$store.dispatch("registration/saveRegistraction",i).then(function(t){(e.loading=!1,t&&t.success)&&(e.$Message.success({content:"成功"}),"add"==e.$route.params.registerId?e.$router.push({path:"/LCSB/LCSB003"}):"1"==sessionStorage.getItem("mlistedit")?e.$router.push({path:"/ma1/registration/"+e.$route.params.registerId}):e.$router.back(-1))})}})},fetchCategory:function(){var t=this;this.$store.dispatch("apply/categories").then(function(e){if(e.success&&e.content){var r=u.a,a=e.content.auctionGroup,i=[{label:"全部",value:""}],s=!0,o=!1,d=void 0;try{for(var c,g=n()(r(a));!(s=(c=g.next()).done);s=!0){var p=c.value,v=l()(p,2),m=v[0],C=v[1];i.push({label:C,value:m})}}catch(t){o=!0,d=t}finally{try{!s&&g.return&&g.return()}finally{if(o)throw d}}t.categories=i}})},getProductAddr:function(){var t=this;return this.productAddr().then(function(e){return t.initAddr(e.content),t.loading=!1,i.a.resolve(e)},function(e){return t.loading=!1,i.a.reject(res)})},initAddr:function(t){if(null!=t){var e=u.a,r=[],a=!0,i=!1,s=void 0;try{for(var o,d=n()(e(t));!(a=(o=d.next()).done);a=!0){var c=o.value,p=l()(c,2),v=(p[0],p[1]);r.push({label:v.text,value:v.code})}}catch(t){i=!0,s=t}finally{try{!a&&d.return&&d.return()}finally{if(i)throw s}}this.originList=r,console.log(g()(this.originList))}},getProductManaList:function(){var t=this;return this.manageType().then(function(e){return t.initManageList(e.content),t.loading=!1,i.a.resolve(e)},function(e){return t.loading=!1,i.a.reject(res)})},initManageList:function(t){if(null!=t){var e=u.a,r=[],a=!0,i=!1,s=void 0;try{for(var o,d=n()(e(t));!(a=(o=d.next()).done);a=!0){var c=o.value,g=l()(c,2),p=(g[0],g[1]);r.push({label:p.text,value:p.code})}}catch(t){i=!0,s=t}finally{try{!a&&d.return&&d.return()}finally{if(i)throw s}}this.managementTypeList=r}},fetchData:function(){var t=this;this.loading=!0,console.log(this.$route.params);this.$route.params;var e="registration/detail";"add"==this.$route.params.registerId?(e="registration/registerInto",this.show=!1,this.title="注册证新增"):(this.show=!0,this.title="注册证编辑"),this.$store.dispatch(e,this.$route.params).then(function(e){if(t.loading=!1,e.success&&e.content&&null!=e.content.data){var r=e.content.data.attributeConfigJson[0].attributes;if(r&&"add"==t.$route.params.registerId){var a={},i=!0,s=!1,o=void 0;try{for(var l,d=n()(r);!(i=(l=d.next()).done);i=!0){var u=l.value;a[u.code+"_fileInfos"]=[],a[u.code]=""}}catch(t){s=!0,o=t}finally{try{!i&&d.return&&d.return()}finally{if(s)throw o}}t.registerCard.attributeJson=a,t.registerCard.attributeConfigJson=e.content.data.attributeConfigJson,console.log("now attributeJson is: "+g()(t.registerCard))}else{t.registerCard=e.content.data;var c=e.content.data.attributeJson;for(var p in c)-1!=p.indexOf("fileInfos")&&null!=c[p]&&0!=c[p].length&&(c[p]=Object(f.remove)(c[p],null));console.log("now resule is: "+g()(t.registerCard))}}})},fetchGroup:function(){},handlePager:function(t){this.filter.page=t}})},b={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("Loading",{attrs:{loading:t.loading}}),t._v(" "),r("top-tool-bar",{attrs:{title:t.title}},[r("span",{attrs:{slot:"btn"},slot:"btn"},[r("Button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("保存")]),t._v(" "),r("Button",{attrs:{type:"primary"},on:{click:function(e){t.backs()}}},[t._v("取消")])],1),t._v(" "),r("span",{attrs:{slot:"content"},slot:"content"},[r("strong",{staticClass:"help"},[t._v("说明")]),t._v(" "),r("p",[t._v("\n        企业向某个项目报名前需提交企业资料申报，\n        "),r("br"),t._v("\n        需准备：基本资料、资质与授权文件。\n        "),r("br"),t._v("\n        支持：保存、编辑、提交审核，\n        "),r("br"),t._v("\n        提交后需管理端确认审核通过。\n      ")])])]),t._v(" "),r("div",{staticClass:"page-container"},[4==t.registerCard.auditStatus||5==t.registerCard.auditStatus?r("div",[r("h5",{staticClass:"title"},[t._v("审核信息")]),t._v(" "),r("table",{staticClass:"info-table"},[r("tr",[r("th",{staticClass:"label"},[t._v("审核结果")]),t._v(" "),r("td",t._l(t.checkresult,function(e){return r("div",[e.value==t.registerCard.auditStatus?r("p",[t._v(t._s(e.label))]):t._e()])}))]),t._v(" "),r("tr",[r("th",{staticClass:"label"},[t._v("审核意见")]),t._v(" "),r("td",[r("p",{staticClass:"text-pre"},[t._v(t._s(t.registerCard.auditOpinion))])])])])]):t._e(),t._v(" "),r("h5",{staticClass:"title"},[t._v("基本信息")]),t._v(" "),r("Form",{ref:"registerCard",attrs:{model:t.registerCard,rules:t.formRule,id:"forms"},on:{submit:t.onSubmit}},[r("table",{staticClass:"info-table"},[r("tr",[r("th",{staticClass:"label"},[r("span",{staticClass:"required"},[t._v("*")]),t._v("注册证编号")]),t._v(" "),r("td",[r("FormItem",{attrs:{prop:"registerCardNo"}},[r("Input",{attrs:{placeholder:"请输入",disabled:t.show},model:{value:t.registerCard.registerCardNo,callback:function(e){t.$set(t.registerCard,"registerCardNo",e)},expression:"registerCard.registerCardNo"}})],1)],1),t._v(" "),r("th",{staticClass:"label"},[r("span",{staticClass:"required"},[t._v("*")]),t._v("注册证有效期起")]),t._v(" "),r("td",[r("Row",[r("Col",{attrs:{span:"12"}},[r("FormItem",{attrs:{prop:"validityStart"}},[r("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",value:t.registerCard.validityStart},on:{"on-change":t.getRegisters}})],1)],1)],1)],1)]),t._v(" "),r("tr",[r("th",{staticClass:"label"},[r("span",{staticClass:"required"},[t._v("*")]),t._v("注册证名称")]),t._v(" "),r("td",[r("FormItem",{attrs:{prop:"registerCardName"}},[r("Input",{attrs:{placeholder:"请输入"},model:{value:t.registerCard.registerCardName,callback:function(e){t.$set(t.registerCard,"registerCardName",e)},expression:"registerCard.registerCardName"}})],1)],1),t._v(" "),r("th",{staticClass:"label"},[r("span",{staticClass:"required"},[t._v("*")]),t._v("注册证有效期止")]),t._v(" "),r("td",[r("Row",[r("Col",{attrs:{span:"12"}},[r("FormItem",{attrs:{prop:"validityEnd"}},[r("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"date",value:t.registerCard.validityEnd},on:{"on-change":t.getRegistere}})],1)],1)],1)],1)]),t._v(" "),r("tr",[r("th",{staticClass:"label"},[r("span",{staticClass:"required"},[t._v("*")]),t._v("产品名称(中文)")]),t._v(" "),r("td",[r("FormItem",{attrs:{prop:"name"}},[r("Input",{attrs:{placeholder:"请输入"},model:{value:t.registerCard.name,callback:function(e){t.$set(t.registerCard,"name",e)},expression:"registerCard.name"}})],1)],1),t._v(" "),r("th",{staticClass:"label"},[t._v("产品名称(英文)")]),t._v(" "),r("td",[r("FormItem",{attrs:{prop:"nameEn"}},[r("Input",{attrs:{placeholder:"请输入"},model:{value:t.registerCard.nameEn,callback:function(e){t.$set(t.registerCard,"nameEn",e)},expression:"registerCard.nameEn"}})],1)],1)]),t._v(" "),r("tr",[r("th",{staticClass:"label"},[r("span",{staticClass:"required"},[t._v("*")]),t._v("生产企业(中文)")]),t._v(" "),r("td",[r("FormItem",{attrs:{prop:"manufactureName"}},[r("Input",{attrs:{placeholder:"请输入"},model:{value:t.registerCard.manufactureName,callback:function(e){t.$set(t.registerCard,"manufactureName",e)},expression:"registerCard.manufactureName"}})],1)],1),t._v(" "),r("th",{staticClass:"label"},[t._v("生产企业(英文)")]),t._v(" "),r("td",[r("FormItem",{attrs:{prop:"manufactureNameEn"}},[r("Input",{attrs:{placeholder:"请输入"},model:{value:t.registerCard.manufactureNameEn,callback:function(e){t.$set(t.registerCard,"manufactureNameEn",e)},expression:"registerCard.manufactureNameEn"}})],1)],1)]),t._v(" "),r("tr",[r("th",{staticClass:"label"},[r("span",{staticClass:"required"},[t._v("*")]),t._v("产地")]),t._v(" "),r("td",[r("div",[r("FormItem",{attrs:{prop:"origin"}},[r("Select",{staticStyle:{width:"200px"},model:{value:t.registerCard.origin,callback:function(e){t.$set(t.registerCard,"origin",e)},expression:"registerCard.origin"}},t._l(t.originList,function(e){return r("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}))],1)],1)]),t._v(" "),r("th",{staticClass:"label"},[t._v("代理企业")]),t._v(" "),r("td",[r("FormItem",{attrs:{prop:"proxyName"}},[r("Input",{attrs:{placeholder:"请输入"},model:{value:t.registerCard.proxyName,callback:function(e){t.$set(t.registerCard,"proxyName",e)},expression:"registerCard.proxyName"}})],1)],1)]),t._v(" "),r("tr",[r("th",{staticClass:"label"},[r("span",{staticClass:"required"},[t._v("*")]),t._v("管理类别")]),t._v(" "),r("td",[r("div",[r("FormItem",{attrs:{prop:"managementType"}},[r("Select",{staticStyle:{width:"200px"},model:{value:t.registerCard.managementType,callback:function(e){t.$set(t.registerCard,"managementType",e)},expression:"registerCard.managementType"}},t._l(t.managementTypeList,function(e){return r("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}))],1)],1)]),t._v(" "),r("th",{staticClass:"label"},[r("span",{staticClass:"required"},[t._v("*")]),t._v("分类目录")]),t._v(" "),r("td",[r("FormItem",{attrs:{prop:"aup2ProjectTypeId"}},[r("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择产品分类",disabled:t.show},model:{value:t.registerCard.aup2ProjectTypeId,callback:function(e){t.$set(t.registerCard,"aup2ProjectTypeId",e)},expression:"registerCard.aup2ProjectTypeId"}},t._l(t.categories,function(e){return r("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}))],1)],1)]),t._v(" "),r("tr",[r("th",{staticClass:"label"},[t._v("注册证型号")]),t._v(" "),r("td",{attrs:{colspan:"3"}},[r("FormItem",{attrs:{prop:"model"}},[r("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5}},model:{value:t.registerCard.model,callback:function(e){t.$set(t.registerCard,"model",e)},expression:"registerCard.model"}})],1)],1)]),t._v(" "),r("tr",[r("th",{staticClass:"label"},[t._v("注册证规格")]),t._v(" "),r("td",{attrs:{colspan:"3"}},[r("FormItem",{attrs:{prop:"standard"}},[r("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5}},model:{value:t.registerCard.standard,callback:function(e){t.$set(t.registerCard,"standard",e)},expression:"registerCard.standard"}})],1)],1)]),t._v(" "),r("tr",[r("th",{staticClass:"label"},[t._v("结构及组成")]),t._v(" "),r("td",{attrs:{colspan:"3"}},[r("FormItem",{attrs:{prop:"structure"}},[r("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5}},model:{value:t.registerCard.structure,callback:function(e){t.$set(t.registerCard,"structure",e)},expression:"registerCard.structure"}})],1)],1)]),t._v(" "),r("tr",[r("th",{staticClass:"label"},[t._v("使用范围")]),t._v(" "),r("td",{attrs:{colspan:"3"}},[r("FormItem",{attrs:{prop:"scope"}},[r("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5}},model:{value:t.registerCard.scope,callback:function(e){t.$set(t.registerCard,"scope",e)},expression:"registerCard.scope"}})],1)],1)])])]),t._v(" "),r("h5",{staticClass:"title"},[t.registerCard.attributeConfigJson.length?r("span",[t._v("\n        "+t._s(t.registerCard.attributeConfigJson[0].name)+"\n      ")]):t._e()]),t._v(" "),t.registerCard.attributeConfigJson.length?r("table",{staticClass:"info-table"},t._l(t.registerCard.attributeConfigJson[0].attributes,function(e,a){return r("tr",[r("th",{staticClass:"label"},[e.allowBlank?t._e():r("span",{staticClass:"required"},[t._v("*")]),t._v(" "+t._s(e.name))]),t._v(" "),r("td",{attrs:{colspan:"3"}},[r("Upload",{attrs:{action:"/portal/pub/comm/uploadimage","on-success":t.handleComplete.bind(this,e.code),"default-file-list":null!=t.registerCard.attributeJson[e.code+"_fileInfos"]?t.registerCard.attributeJson[e.code+"_fileInfos"]:[],"before-upload":t.handleSelect.bind(this,e.code+"_fileInfos"),"on-remove":t.handleRemove.bind(this,e.code),"on-preview":t.handleReview,"on-format-error":t.handleFormatError,format:["jpg","jpeg","png","gif","zip"]}},[r("Button",{attrs:{type:"ghost"}},[t._v("上传文件")])],1),t._v(" "),4==t.registerCard.auditStatus||5==t.registerCard.auditStatus?r("div",[null!=t.registerCard.auditData?r("div",[e.code in t.registerCard.auditData?r("p",[r("span",[t._v("审核状态：")]),t._v(" "),r("span",{staticStyle:{color:"#f00"}},[t._v("\n                      不通过\n                    ")])]):t._e(),t._v(" "),e.code in t.registerCard.auditData?r("p",[r("span",[t._v("审核意见：")]),t._v(" "),r("span",{staticClass:"text-pre"},[t._v("\n                        "+t._s(t.registerCard.auditData[e.code])+"\n                      ")])]):t._e()]):t._e()]):t._e()],1),t._v(" "),null!=e.templates&&e.templates.length>0?r("td",{staticStyle:{width:"120px","text-align":"center"}},[r("p",[r("a",{attrs:{href:e.templates[0].url,target:"_blank"}},[t._v("模板下载")])])]):r("td",{staticStyle:{width:"120px","text-align":"center"}})])})):t._e(),t._v(" "),r("Modal",{attrs:{width:"800",title:"查看大图"},on:{"on-ok":function(t){},"on-cancel":function(e){t.preview=!1}},model:{value:t.preview,callback:function(e){t.preview=e},expression:"preview"}},[r("img",{staticStyle:{width:"100%"},attrs:{src:t.previewUrl,alt:"",id:"previewUrl"}})])],1)],1)},staticRenderFns:[]};var y=r("VU/8")(_,b,!1,function(t){r("2CeI")},"data-v-0aa1d634",null);e.default=y.exports}});